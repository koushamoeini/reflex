# پروژه Reflex - تیم توسعه

## اعضای تیم
- **کوشا معینی** - 401100228 (Step 1 & 2)
- **آرمان آریان‌پور** - 401170072 (Step 3 & 4)

## توضیحات
در این پروژه، پروتکل پنهان‌گر Reflex برای هسته Xray پیاده‌سازی شده است. تمرکز اصلی بر روی امنیت، مقاومت در برابر شناسایی و کارایی بالا بوده است.

## کارهای انجام شده (Step 1 & 2) - کوشا معینی
- **Step 1:** طراحی ساختار پکیج و تنظیمات مورد نیاز (Config Protocol) و ثبت آن‌ها در Xray.
- **Step 2:** پیاده‌سازی منطق هندشیک (Handshake) با استفاده از X25519 و احراز هویت کاربران بر اساس UUID و مدیریت کلیدهای نشست.

## کارهای انجام شده (Step 3 & 4) - آرمان آریان‌پور
- **Step 3:** ساختن Traffic Morphing برای اینکه ترافیک شبیه HTTP معمولی بشه و DPI نتونه تشخیص بده. یه سری random padding هم اضافه کردم که سایز واقعی داده‌ها پنهون بمونه.
- **Step 4:** نوشتن تست‌های مختلف برای چک کردن درستی کد. شامل unit test، edge case test، benchmark test و fuzz test می‌شه. همچنین یه سری example test هم نوشتم که بشه راحت‌تر فهمید چجوری از پروتکل استفاده کنیم.

## نحوه اجرا
برای اجرا کافیست کد را کامپایل کرده و فایل `config.json` را بر اساس ریفلکس تنظیم کنید:
```bash
cd xray-core/main
go build
./main -config ../../config.example.json
```

## مشکلات و راه‌حل‌ها
### کوشا معینی (Step 1 & 2)
بزرگترین چالش، مدیریت تداخل بایت‌ها در هنگام هندشیک ضمنی بود که با استفاده از `Peek` در بافر ورودی و استفاده از `Magic Bytes` برای تفکیک ترافیک ریفلکس از ترافیک عادی حل شد.

### آرمان آریان‌پور (Step 3 & 4)
اول وقتی داشتم morphing رو می‌نوشتم نمی‌دونستم چجوری باید padding ها رو تصادفی کنم که از یه الگوی ثابت تبعیت نکنه. بعدش فهمیدم باید از crypto/rand استفاده کنم نه math/rand. یه مشکل دیگه هم این بود که تست‌ها خیلی طول می‌کشیدن، آخرشم timeout ها رو بیشتر کردم و برای fuzz test هم iteration count رو کم کردم.
